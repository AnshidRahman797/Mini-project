<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kampus Connect</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://kit.fontawesome.com/ab05a6b4fa.js" crossorigin="anonymous"></script>
  
    <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>

<!-- Firebase Auth -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>


<script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAx3LcZnN2DSwx-YLdvG7an0Mgnr4NlQXk",
      authDomain: "event-management-6eab1.firebaseapp.com",
      projectId: "event-management-6eab1",
      storageBucket: "event-management-6eab1.appspot.com",
      messagingSenderId: "792652272458",
      appId: "1:792652272458:web:0aa7019690d73b7801e7b3"
    };
  
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  
    async function loadRandomEvent() {
      try {
        const snapshot = await db.collection("verified_events").get();
        const docs = snapshot.docs;
  
        if (docs.length === 0) return;
  
        // Display single random event in main and mini image
        const randomDoc = docs[Math.floor(Math.random() * docs.length)];
        const data = randomDoc.data();
  
        const titleEl = document.getElementById("event-title");
        const dateEl = document.getElementById("event-date");
        const mainImage = document.getElementById("main-image");
        const miniImage = document.getElementById("mini-image");
  
        if (titleEl) titleEl.textContent = data.event_name || "Untitled Event";
        if (dateEl) dateEl.textContent = data.start_date || "TBA";
  
        const base64Prefix = "data:image/jpeg;base64,";
        const imageSrc = data.event_image_base64 ? `${base64Prefix}${data.event_image_base64}` : "fallback.jpg";
  
        if (mainImage) mainImage.src = imageSrc;
        if (miniImage) miniImage.src = imageSrc;
  
        const miniImageContainer = document.getElementById("miniImageContainer");
  
        // ALSO: Display 6 random event cards below
        loadRandomEventCards(docs);
        loadWorkshopEventCards(docs);
        loadHackathonEventCards(docs);


  
      } catch (error) {
        console.error("Error loading event:", error);
      }
    }
  
    function renderEventCard(eventData) {
      const container = document.createElement("div");
      container.className = "feature-container";
      container.onclick = () => openPopup({
        title: eventData.event_name,
        description: eventData.event_caption,
        imageUrl: `data:image/jpeg;base64,${eventData.event_image_base64}`,
        date: new Date(eventData.start_date).toDateString(),
        collegeName: eventData.college,
        collegeLocation: `${eventData.city}, ${eventData.state}`,
        contactNumber: eventData.contact_number || "N/A",
        contactEmail: eventData.contact_email || "N/A",
        registrationFee: eventData.event_fee || "N/A",
        registrationLink: eventData.registration_link || "#",
        eventDescription: eventData.event_description || ""
      });
  
      container.innerHTML = `
        <div class="feature-card">
          <span class="feature-hover-text">${eventData.event_caption}</span>
          <img src="data:image/jpeg;base64,${eventData.event_image_base64}" alt="${eventData.event_name}">
        </div>
        <div class="feature-details">
          <h3 class="feature-title">${eventData.event_name}</h3>
          <p class="feature-author">on&nbsp;&nbsp;&nbsp;<strong>${new Date(eventData.start_date).toDateString()}</strong></p>
        </div>
      `;
  
      document.querySelector(".feature-grid").appendChild(container);
    }
  
    function loadRandomEventCards(allDocs) {
      if (!Array.isArray(allDocs)) return;
  
      const events = allDocs.map(doc => doc.data());
      events.sort(() => 0.5 - Math.random()); // shuffle
      const selected = events.slice(0, 6);
  
      const featureGrid = document.querySelector(".feature-grid");
      if (featureGrid) {
        featureGrid.innerHTML = ""; // Clear any existing
        selected.forEach(renderEventCard);
      }
    }

    function loadWorkshopEventCards(allDocs) {
        if (!Array.isArray(allDocs)) return;

        const workshops = allDocs
            .map(doc => doc.data())
            .filter(event => event.event_type?.toLowerCase() === "workshop");

        workshops.sort(() => 0.5 - Math.random()); // shuffle
        const selected = workshops.slice(0, 6);

        const workshopGrid = document.getElementById("workshop-grid");
        if (workshopGrid) {
            workshopGrid.innerHTML = ""; // Clear any existing
            selected.forEach(eventData => {
            const container = document.createElement("div");
            container.className = "feature-container";
            container.onclick = () => openPopup({
                title: eventData.event_name,
                description: eventData.event_caption,
                imageUrl: `data:image/jpeg;base64,${eventData.event_image_base64}`,
                date: new Date(eventData.start_date).toDateString(),
                collegeName: eventData.college,
                collegeLocation: `${eventData.city}, ${eventData.state}`,
                contactNumber: eventData.contact_number || "N/A",
                contactEmail: eventData.contact_email || "N/A",
                registrationFee: eventData.event_fee || "N/A",
                registrationLink: eventData.registration_link || "#",
                eventDescription: eventData.event_description || ""
            });

            container.innerHTML = `
                <div class="feature-card">
                <span class="feature-hover-text">${eventData.event_caption}</span>
                <img src="data:image/jpeg;base64,${eventData.event_image_base64}" alt="${eventData.event_name}">
                </div>
                <div class="feature-details">
                <h3 class="feature-title">${eventData.event_name}</h3>
                <p class="feature-author">on&nbsp;&nbsp;&nbsp;<strong>${new Date(eventData.start_date).toDateString()}</strong></p>
                </div>
            `;

            workshopGrid.appendChild(container);
            });
        }
        }

        function loadHackathonEventCards(allDocs) {
            if (!Array.isArray(allDocs)) return;

            const hackathons = allDocs
                .map(doc => doc.data())
                .filter(event => event.event_type?.toLowerCase() === "hackathon");

            hackathons.sort(() => 0.5 - Math.random()); // shuffle
            const selected = hackathons.slice(0, 6);

            const hackathonGrid = document.getElementById("hackathon-grid");
            if (hackathonGrid) {
                hackathonGrid.innerHTML = ""; // Clear any existing
                selected.forEach(eventData => {
                const container = document.createElement("div");
                container.className = "feature-container";
                container.onclick = () => openPopup({
                    title: eventData.event_name,
                    description: eventData.event_caption,
                    imageUrl: `data:image/jpeg;base64,${eventData.event_image_base64}`,
                    date: new Date(eventData.start_date).toDateString(),
                    collegeName: eventData.college,
                    collegeLocation: `${eventData.city}, ${eventData.state}`,
                    contactNumber: eventData.contact_number || "N/A",
                    contactEmail: eventData.contact_email || "N/A",
                    registrationFee: eventData.event_fee || "N/A",
                    registrationLink: eventData.registration_link || "#",
                    eventDescription: eventData.event_description || ""
                });

                container.innerHTML = `
                    <div class="feature-card">
                    <span class="feature-hover-text">${eventData.event_caption}</span>
                    <img src="data:image/jpeg;base64,${eventData.event_image_base64}" alt="${eventData.event_name}">
                    </div>
                    <div class="feature-details">
                    <h3 class="feature-title">${eventData.event_name}</h3>
                    <p class="feature-author">on&nbsp;&nbsp;&nbsp;<strong>${new Date(eventData.start_date).toDateString()}</strong></p>
                    </div>
                `;

                hackathonGrid.appendChild(container);
                });
            }
            }
    document.addEventListener("DOMContentLoaded", loadRandomEvent);

    document.addEventListener("DOMContentLoaded", function () {
        let loginButton = document.querySelector(".auth-buttons a[href='login.html']");
        let signupButton = document.querySelector(".auth-buttons a[href='signup.html']");
        let profileIcon = document.getElementById("profileIcon");
        let logoutButton = document.getElementById("logoutButton");
        let createEventLink = document.getElementById("createEventLink");
        let viewEventsLink = document.getElementById("viewEventsLink");
        let viewWorkshopLink = document.getElementById("viewWorkshopLink");
        let viewHackathonLink = document.getElementById("viewHackathonLink");
        let explorebox = document.getElementById("explore-box");
        let searchbox = document.getElementById("search-box2");


        // âœ… Ensure elements exist before modifying them
        if (!loginButton || !signupButton || !profileIcon || !logoutButton || !createEventLink) {
            console.error("One or more elements not found!");
            return;
        }

        // âœ… Set default visibility
        loginButton.style.display = "inline-block";
        signupButton.style.display = "inline-block";
        profileIcon.style.display = "none";
        logoutButton.style.display = "none";

        // âœ… Login logic
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            console.log("User is logged in");
            loginButton.style.display = "none";
            signupButton.style.display = "none";
            profileIcon.style.display = "block";
            logoutButton.style.display = "inline-block";
            createEventLink.href = "createevent.html"; // ðŸ”¹ Set correct link when logged in
            viewEventsLink.href = "events.html";
            explorebox.href = "events.html";
            searchbox.href ="events.html";
            viewWorkshopLink.href = "events.html?filter=Workshop";
            viewHackathonLink.href = "events.html?filter=Hackathon";
            createEventLink.style.display = "block";    // Show button
        } else {
            console.log("User is NOT logged in");
            createEventLink.href = "login.html";        // ðŸ”¹ Redirect to login if not logged in
            viewEventsLink.href = "login.html";
            viewWorkshopLink.href = "login.html";
            viewHackathonLink.href = "login.html";
            explorebox.href = "signup.html";
            searchbox.href = "signup.html";
            createEventLink.style.display = "block";    // Show button anyway, but as login
        }
      });
      logoutButton.addEventListener("click", function (event) {
        event.preventDefault();
        firebase.auth().signOut().then(() => {
          window.location.href = "index.html";
        }).catch((error) => {
          console.error("Error signing out:", error);
        });
      });
    });

    firebase.auth().onAuthStateChanged(async (user) => {
    if (user) {
        console.log("User is logged in");

        try {
            const tokenResult = await user.getIdTokenResult();
            console.log("Token claims:", tokenResult.claims);

            if (tokenResult.claims.admin) {
                console.log("Admin detected: revealing admin link.");
                document.getElementById("adminLinkContainer").style.display = "block";
            } else {
                document.getElementById("adminLinkContainer").style.display = "none";
            }
        } catch (error) {
            console.error("Error getting token claims:", error);
        }

    } else {
        console.log("User is NOT logged in");
        document.getElementById("adminLinkContainer").style.display = "none";
    }
});


  </script>
   

</head>
<body>
    <header class="navbar" id="home-navbar">
        <div class="logo">K.</div>
        <nav>
            <ul class="nav-links">
                <li><a href="events.html" id="explore-box">Explore</a></li>
                <li><a href="#feature-events-section">Events</a></li>
                <li><a href="#workshop-events-section">Workshops</a></li>
                <li><a href="#hackathon-events-section">Hackathons</a></li>
            </ul>
        </nav>
        <a href="events.html" id="search-box2">
        <div class="search-container">
            <input type="text" placeholder="Search for College Events" id="search-box">
            <button id="search-btn"><i class="fas fa-search"></i></button>
        </div>
        </a>
        <div class="auth-buttons">
            <a href="login.html" id="loginButton">Log in</a>
            <a href="signup.html" id="signupButton">Sign Up</a>
            <a href="#" id="logoutButton" style="display: none;">Logout</a>
        </div>
        <div class="profile-icon" id="profileIcon" style="display: none;">
            <i class="fas fa-user-circle"></i>
        </div>
            <a href="createevent.html" id="createEventLink">
                <button class="btn-pro">Submit Event</button>
            </a>
        </div>  
    </header>

    <section class="searchbar">
        <div class="search-popup" id="searchPopup">
            <div class="search-popup-content">
                <div class="search-container-2">
                    <input type="text" placeholder="Search for College Events">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </div> 
    </section>

    <section class="hero">
        <p class="upcoming">
          Upcoming event: <span class="date" id="event-date">Loading...</span>
        </p>
        <h1 class="title" id="event-title">Loading...</h1>
      </section>
      
      <section class="image-section" id="eventImageSection">
        <div class="image-container" id="miniImageContainer">
          <img id="main-image" src="" alt="Featured Image" class="featured-image" />
          <img id="mini-image" src="" alt="Mini Image" class="mini-image" />
        </div>
      </section>
      
    

    <section class="hero2" id="feature-events-section">
        <p class="upcoming">Events</p>
        <h1 class="title">FEATURED</h1>
    </section>

    <section class="feature-section">
        <div class="feature-grid"></div> <!-- For the 6 random events -->

        <!-- View More Link -->
        <div class="view-more">
            <p>
              Check out all events&nbsp;&nbsp;<span class="arrow">â†’</span>
              <a href="events.html" class="view-events" id="viewEventsLink">View Events</a>
            </p>
          </div>          
    </section>    

    <section class="hero2" id="workshop-events-section">
        <p class="upcoming">upcoming</p>
        <h1 class="title">WORKSHOPS</h1>
      </section>
      
      <section class="feature-section">
        <div class="feature-grid" id="workshop-grid"></div> <!-- For 6 workshops -->
      
        <!-- View More Link -->
        <div class="view-more">
          <p>
            Explore all workshops&nbsp;&nbsp;<span class="arrow">â†’</span> 
            <a href="events.html?filter=Workshop" class="view-events" id="viewWorkshopLink">View Workshops</a>
          </p>
        </div>
      </section>

      <section class="hero2" id="hackathon-events-section">
        <p class="upcoming">Featured</p>
        <h1 class="title">HACKATHONS</h1>
      </section>
      
      <section class="feature-section">
        <div class="feature-grid" id="hackathon-grid"></div> <!-- For 6 hackathons -->
      
        <!-- View More Link -->
        <div class="view-more">
          <p>Discover more hackathons&nbsp;&nbsp;<span class="arrow">â†’</span> 
            <a href="events.html?filter=hackathon" class="view-events" id="viewHackathonLink">View Hackathons</a>
          </p>
        </div>
      </section>
      
      
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <span>K.</span>
            </div>
            <div class="footer-links">
                <div class="footer-column" id="adminLinkContainer" style="display:none">
                    <a href="adminpanel.html">Admin Panel</a>
                </div>
                <div class="footer-column">
                    <a href="#home-navbar">Home</a>
                    <a href="#feature-events-section">Events</a>
                    <a href="events.html">Explore</a>
                </div>
                <div class="footer-column">
                    <a href="#workshop-events-section">Workshops</a>
                    <a href="#hackathon-events-section">Hackathons</a>
                </div>
                <div class="footer-column">
                    <a href="faq.html">FAQs</a>
                    <a href="aboutUs.html">About Us</a>
                    <a href="contact.html">Contact Us</a>
                </div>
            </div>
        </div>
    </footer>    

    <nav class="bottom-nav" id="bottomNav">
        <ul>
            <li><a href="#" class="static-btn">K.</a></li>
            <li><a href="#home-navbar"></i> Home</a></li>
            <li><a href="#feature-events-section"></i> Events</a></li>
            <li><a href="#workshop-events-section"> Workshops</a></li>
            <li><a href="#hackathon-events-section">Hackathons</a></li>
            <li><a href="createevent.html" class="static-btn2">Submit Event</a></li>
        </ul>
    </nav>

    <script>
      const bottomNav = document.getElementById("bottomNav");
      let inactivityTimeout;
  
      function hideBottomNav() {
          bottomNav.style.opacity = "0";
          bottomNav.style.pointerEvents = "none";
      }
  
      function showBottomNav() {
          bottomNav.style.opacity = "1";
          bottomNav.style.pointerEvents = "auto";
      }
  
      function resetInactivityTimer() {
          showBottomNav();
          clearTimeout(inactivityTimeout);
          inactivityTimeout = setTimeout(hideBottomNav, 5000);
      }
  
      // Monitor user activity
      document.addEventListener("mousemove", resetInactivityTimer);
      document.addEventListener("touchstart", resetInactivityTimer);
      document.addEventListener("scroll", resetInactivityTimer);
  
      // Initialize the timer
      resetInactivityTimer();
  </script>
  

</body>

</html>

