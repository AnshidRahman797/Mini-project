<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>Event Registration Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      margin: 0;
      padding: 20px;
    }

    .form-container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .image-preview {
      text-align: center;
      margin-bottom: 20px;
    }

    .image-preview img {
  max-width: 300px;
  max-height: 300px;
  width: auto;
  height: auto;
  display: block;
  margin: 0 auto;
  border-radius: 10px;
  object-fit: contain;
}


    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 6px;
    }

    input, select, textarea {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 15px;
    }

    textarea {
      resize: vertical;
    }

    .error-msg {
      color: red;
      font-size: 13px;
      margin-top: 4px;
    }

    button {
      background: black;
      color: white;
      padding: 12px;
      border: none;
      width: 100%;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <a href="adminpanel.html" style="position: relative; font-weight: bold; top: 10px; right: 10px; text-decoration: none; font-size: 20px; color: rgb(0, 0, 0);">
      <i class="fas fa-arrow-left" style="margin-right: 5px;"></i></a>
        <h2>Enter the Details</h2>
    <form id="eventForm" method="POST" action="/submit_verified_event" novalidate>
      <div class="image-preview">
        <img id="previewImg" src="" alt="Event Image" style="display: none; margin-bottom: 10px;" />
        <p id="scrapedCaption" style="font-style: italic;"></p>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Event Name: *</label>
          <input type="text" name="event_name" required />
        </div>
        <div class="form-group">
          <label>Event Caption: *</label>
          <input type="text" name="event_caption" required />
        </div>
        <div class="form-group">
          <label>Event Type: *</label>
          <select name="event_type" required>
            <option value="">Select</option>
            <option value="Workshop">Workshop</option>
            <option value="Seminar">Seminar</option>
            <option value="Competition">Competition</option>
            <option value="Celebration">Celebration</option>
            <option value="others">others</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Event Fee:</label>
          <input type="text" name="event_fee" />
        </div>
        <div class="form-group">
          <label for="start_date">Start Date:</label>
          <input type="date" id="start_date" name="start_date" required>
          <small id="startDateError" class="error-text" style="color:red; display:none;">Start date is required</small>
        </div>
        
        <div class="form-group">
          <label for="end_date">End Date:</label>
          <input type="date" id="end_date" name="end_date" required>
          <small id="endDateError" class="error-text" style="color:red; display:none;">End date is required</small>
          <small id="dateOrderError" class="error-text" style="color:red; display:none;">End date must be after or equal to start date</small>
        </div>
        
        
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="singleDayCheckbox" onchange="toggleEndDate()"> This is a one-day event
        </label>
      </div>


      <div class="form-row">
        <div class="form-group">
          <label>Country: *</label>
          <input type="text" name="country" value="India" readonly required />
        </div>
        <div class="form-group">
          <label>State: *</label>
          <select name="state" id="state" required>
            <option value="">Select State</option>
        </select>
        </div>
        <div class="form-group">
          <label>City: *</label>
          <select name="city" id="city" required>
            <option value="">Select city</option>
        </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>College: *</label>
          <select name="college" id="college" required>
            <option value="">Select College</option>
        </select>
        </div>
        <div class="form-group">
          <label>Contact Email: *</label>
          <input type="email" name="contact_email" required />
        </div>
        <div class="form-group">
          <label>Contact Number: *</label>
          <input type="text" name="contact_number" required />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label>Event Description:</label>
          <textarea name="event_description" rows="4"></textarea>
        </div>
      </div>

      <button type="submit">Submit</button>
    </form>
  </div>

  <script>
    // Assuming scraped data is passed via query params: ?image_url=...&caption=...
    window.addEventListener("load", () => {
      const eventData = JSON.parse(sessionStorage.getItem("eventData"));
      if (eventData) {
        var previewImg = document.getElementById("previewImg");
        const captionPara = document.getElementById("scrapedCaption");
        if (previewImg) {
  // Safe to manipulate previewImg
        } else {
          console.error("Element with ID 'previewImg' not found.");
        }  
    
    // Set image source (you might need to prepend the MIME type if it's not included)
        previewImg.src = `data:image/jpeg;base64,${eventData.image_base64}`;
        previewImg.style.display = "block";
    
    // Set caption text
        captionPara.textContent = eventData.caption;
      }
    });
    document.getElementById("eventForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            // Create a FormData object to extract form values
            const formData = new FormData(this);
            // If you already have image URL (base64), you can append it:
            const base64Data = previewImg.src.split(',')[1];
  
            formData.append("event_image_base64", base64Data);
          
      
            // Convert form data to a plain object
            const data = {};
            formData.forEach((value, key) => data[key] = value);
      
            try {
              const response = await fetch("http://127.0.0.1:5000/submit_verified_event", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
              });
              const result = await response.json();
              if (response.ok) {
                // Display success message (or redirect)
                alert("Event registered successfully!");
                // Optionally, redirect to another page:
                // window.location.href = "some_page.html";
              } else {
                alert("Error: " + result.error);
              }
            } catch (error) {
              console.error("Submission error:", error);
              alert("An error occurred while submitting the event.");
            }
          });

    document.getElementById("eventForm").addEventListener("submit", function (e) {
      let valid = true;
      const fields = this.querySelectorAll("input, select");

      fields.forEach((field) => {
        const label = field.closest(".form-group")?.querySelector("label");
        const isRequired = label?.textContent.includes("*");
        const errorEl = field.nextElementSibling;
        if (errorEl && errorEl.classList.contains("error-msg")) errorEl.remove();

        field.style.borderColor = "#ccc";

        if (isRequired && !field.value.trim()) {
          showError(field, "invalid input");
          valid = false;
        } else if (field.name === "contact_email" && !/^\S+@\S+\.\S+$/.test(field.value.trim())) {
          showError(field, "invalid input");
          valid = false;
        } else if (field.name === "contact_number" && !/^\d{10}$/.test(field.value.trim())) {
          showError(field, "invalid input");
          valid = false;
        } else if (field.name === "event_fee" && field.value.trim() && isNaN(field.value.trim())) {
          showError(field, "invalid input");
          valid = false;
        }
      });

      if (!valid) e.preventDefault();

      function showError(field, message) {
        field.style.borderColor = "red";
        const error = document.createElement("span");
        error.className = "error-msg";
        error.textContent = message;
        field.parentNode.appendChild(error);
      }
    });
  </script>
  <script>
    function toggleEndDate() {
      const checkbox = document.getElementById("singleDayCheckbox");
      const startDate = document.getElementById("start_date");
      const endDate = document.getElementById("end_date");
  
      if (checkbox.checked) {
        endDate.value = startDate.value;
        endDate.disabled = true;
  
        // Keep syncing if user changes start date
        startDate.addEventListener('change', () => {
          if (checkbox.checked) endDate.value = startDate.value;
        });
      } else {
        endDate.disabled = false;
      }
    }
  </script>
  <script>
    function toggleEndDate() {
      const checkbox = document.getElementById("singleDayCheckbox");
      const startDate = document.getElementById("start_date");
      const endDate = document.getElementById("end_date");
  
      if (checkbox.checked) {
        endDate.value = startDate.value;
        endDate.disabled = true;
  
        startDate.addEventListener('change', () => {
          if (checkbox.checked) endDate.value = startDate.value;
        });
      } else {
        endDate.disabled = false;
      }
    }
  
    document.getElementById("eventForm").addEventListener("submit", function (e) {
      const startDate = document.getElementById("start_date");
      const endDate = document.getElementById("end_date");
  
      let valid = true;
  
      // Reset errors
      document.querySelectorAll(".error-text").forEach(el => el.style.display = "none");
  
      if (!startDate.value) {
        document.getElementById("startDateError").style.display = "block";
        valid = false;
      }
  
      if (!endDate.value && !endDate.disabled) {
        document.getElementById("endDateError").style.display = "block";
        valid = false;
      }
  
      // Check date logic
      if (startDate.value && endDate.value && new Date(endDate.value) < new Date(startDate.value)) {
        document.getElementById("dateOrderError").style.display = "block";
        valid = false;
      }
  
      if (!valid) e.preventDefault(); // prevent form submission
    });
  </script>
  <script>        const statesAndCities = {
    "Andhra Pradesh": {
        "Visakhapatnam": ["Andhra University", "GITAM University", "Gayatri Vidya Parishad", "Raghu Engineering College", "ANITS"],
        "Vijayawada": ["PVP Siddhartha College", "VR Siddhartha Engineering College", "SRK Institute", "Nalanda Degree College", "KBN College"],
        "Guntur": ["Acharya Nagarjuna University", "RVR & JC College", "Hindu College", "Vignan University", "TJPS College"],
        "Tirupati": ["Sri Venkateswara University", "SVCE", "SV Arts College", "Rashtriya Sanskrit Vidyapeetha", "Sree Vidyanikethan"],
        "Kurnool": ["Rayalaseema University", "Osmania College", "St. Joseph’s College", "KVR College", "Silver Jubilee College"]
    },
    "Karnataka": {
        "Bangalore": ["IISc Bangalore", "RV College of Engineering", "BMS College of Engineering", "Christ University", "Presidency College"],
        "Mysore": ["SJCE Mysore", "Vidyavardhaka College", "JSS Science & Technology", "Mysore Medical College", "Mahajana College"],
        "Hubli": ["BVBCET", "KLE Technological University", "SDM College", "KIMS Hubli", "Deshpande Startups"],
        "Mangalore": ["NITTE University", "St. Aloysius College", "Yenepoya University", "MIT Manipal", "AJ Institute of Engineering"],
        "Belgaum": ["KLE University", "VTU Belgaum", "Gogte Institute of Technology", "BIMS", "Angadi Institute of Technology"]
    },
    "Tamil Nadu": {
        "Chennai": ["IIT Madras", "Anna University", "Loyola College", "Madras Christian College", "SRM University"],
        "Coimbatore": ["PSG College of Technology", "Coimbatore Institute of Technology", "Karunya University", "Kumaraguru College", "Amrita University"],
        "Madurai": ["Madurai Kamaraj University", "Thiagarajar College of Engineering", "American College", "Fatima College", "Lady Doak College"],
        "Trichy": ["NIT Trichy", "Bishop Heber College", "Periyar EVR College", "SASTRA University", "Oxford Engineering College"],
        "Salem": ["Vinayaka Missions University", "Sona College of Technology", "Government College of Engineering", "AVS Engineering College", "Knowledge Institute of Technology"]
    },
    "Kerala": {
        "Thiruvananthapuram": ["University of Kerala", "College of Engineering Trivandrum", "LBS Institute of Technology", "Mar Ivanios College", "Government Medical College", "All Saints' College, Thiruvananthapuram","Government College for Women, Thiruvananthapuram","Loyola College of Social Sciences, Thiruvananthapuram","College of Fine Arts, Thiruvananthapuram","Sree Chitra Thirunal College of Engineering, Thiruvananthapuram","Government Law College, Thiruvananthapuram","Other"],
        "Palakkad" :["Government Engineering College, Sreekrishnapuram","Government Victoria College","NSS College of Engineering","Mercy College, Palakkad","Chembai Memorial Government Music College","MES College of Engineering, Kuttippuram","Vidya Academy of Science and Technology","Vidya Academy of Science and Technology","Yuvakshetra Institute of Management Studies","Sree Neelakanta Government Sanskrit College","Other"],
        "Kochi": ["CUSAT", "SCMS School of Engineering", "Rajagiri College", "St. Teresa's College", "Sacred Heart College","Government Law College, Ernakulam","Amrita Institute of Medical Sciences","Model Engineering College","Federal Institute of Science and Technology (FISAT)","Toc H Institute of Science and Technology","Other"],
        "Idukki" :["Mar Baselios Christian College of Engineering and Technology","Government College, Kattappana","Government Engineering College, Painav, Idukki","College of Engineering, Munnar","Government Polytechnic College, Nedumkandam","Marian College, Kuttikanam","St. Thomas College, Thodupuzha","Al-Azhar College of Arts and Science","Government College, Munnar","St. Joseph's College, Moolamattom","Jawaharlal Nehru Institute of Arts and Science","Other"],
        "Malappuram" : ["MES Keveeyam College, Valanchery","PSMO College, Tirurangadi","Government College, Malappuram","MEA Engineering College","MEA Engineering College","Aligarh Muslim University (AMU) Centre, Malappuram","Aligarh Muslim University (AMU) Centre, Malappuram","Government Medical College, Manjeri","EMEA College of Arts and Science","MES Medical College, Perinthalmanna","Other"],
        "Kottayam" :["Rajiv Gandhi Institute of Technology (RIT)","CMS College, Kottayam","Baselius College, Kottayam","Baselius College, Kottayam","Alphonsa College, Pala","Alphonsa College, Pala","Assumption College, Changanacherry","B.C.M. College for Women, Kottayam","Bishop Kurialacherry College for Women, Amalagiri","Bishop Vayalil Memorial Holy Cross College, Cherpunkal","Amal Jyothi College of Engineering, Kanjirapally","College of Applied Science (IHRD), Njeezhoor","Other"],
        "Alappuzha" :["Sanatana Dharma College, Alappuzha","St. Joseph's College for Women, Alappuzha","T.D. Medical College, Alappuzha","College of Engineering, Chengannur","College of Engineering, Cherthala","Bishop Moore College, Mavelikara","MSM College, Kayamkulam","KVM College of Nursing, Cherthala","College of Applied Science, Mavelikara","KVM College of Arts and Science, Cherthala","Other"],
        "Pathanamthitta" :["Catholicate College, Pathanamthitta","Mar Athanasius College, Pathanamthitta","St. Thomas College, Kozhencherry","Mount Zion College of Engineering, Pathanamthitta","Believers Church Medical College, Thiruvalla","Pushpagiri Institute of Medical Sciences and Research Centre, Thiruvalla","Mar Chrysostom College of Education, Pathanamthitta","Mannam Ayurveda Co-operative Medical College, Pandalam","Sree Buddha College of Engineering, Pattoor","KVVS Institute of Technology, Adoor","Other"],
        "Kozhikode": ["Government Medical College, Kozhikode", "IIM Kozhikode", "NIT Calicut", "Farook College", "Providence Women's College", "Zamorin’s Guruvayurappan College","Devagiri College","Government Engineering College, Kozhikode","Malabar Christian College","KMCT College of Engineering","AWH Engineering College","Markaz Arts and Science College","Other"],
        "Wayanad" :["Government Engineering College, Wayanad","WMO Arts and Science College, Muttil","Mary Matha Arts & Science College, Mananthavady","Don Bosco College, Sulthan Bathery","Pazhassi Raja College, Pulpally","Oriental College of Hotel Management","College of Veterinary and Animal Sciences, Pookode","Indira Gandhi College of Arts & Science","St. Mary's College, Sulthan Bathery","Jawaharlal Nehru College, Panamaram","Other"],
        "Kannur" :["Government Engineering College, Kannur","Kannur University","Government Brennen College, Thalassery","Sir Syed College, Taliparamba","College of Engineering, Thalassery","Don Bosco Arts and Science College","Government Medical College, Pariyaram","Chinmaya Institute of Technology","Sree Narayana College, Kannur","College of Applied Science, Pattuvam","Other"],
        "Thrissur": ["Government Engineering College Thrissur", "Kerala Agricultural University", "Sahrdaya College of Engineering", "St. Thomas College", "Christ College","Amala Institute of Medical Sciences","Government Medical College, Thrissur","Government Medical College, Thrissur","Sree Kerala Varma College","IES College of Engineering","Other"],
        "Kasaragod" :["Central University of Kerala","Government College, Kasaragod","Malik Deenar College of Pharmacy","Government Polytechnic College, Kasaragod","College of Engineering, Trikaripur","Nehru Arts and Science College","LBS College of Engineering","Sullamussalam Science College","Malik Deenar Institute of Management Studies","Kasaragod Institute of Technology","Other"],
        "Kollam": ["TKM College of Engineering", "MES Institute of Technology", "Amrita Vishwa Vidyapeetham", "Sree Narayana College", "Younus College of Engineering","Fatima Mata National College, Kollam","Bishop Jerome Institute, Kollam","Travancore Medical College, Kollam","Kumbalathu Sankupilla Memorial Devaswom Board College","College of Teacher Education, Arkannoor, Ayur","College of Engineering, Perumon","Sree Narayana Institute of Medical Sciences, Kollam","Other"]
    },
    "Maharashtra": {
        "Mumbai": ["IIT Bombay", "University of Mumbai", "St. Xavier's College", "VJTI", "NMIMS"],
        "Pune": ["Savitribai Phule Pune University", "College of Engineering Pune", "Fergusson College", "MIT Pune", "Bharati Vidyapeeth University"],
        "Nagpur": ["VNIT Nagpur", "Nagpur University", "YCCE", "LIT Nagpur", "GHRCE"],
        "Nashik": ["K. K. Wagh Institute of Engineering", "Sandip University", "Nashik District Maratha Vidya Prasarak Samaj", "Yashwantrao Chavan Maharashtra Open University", "MET Bhujbal Knowledge City"],
        "Aurangabad": ["Dr. Babasaheb Ambedkar Marathwada University", "MIT Aurangabad", "Government College of Engineering Aurangabad", "Deogiri College", "MGM University"]
    },
    "Punjab": {
        "Chandigarh": ["Panjab University", "PEC Chandigarh", "Chandigarh University", "DAV College", "GGDSD College"],
        "Ludhiana": ["Punjab Agricultural University", "Guru Nanak Dev Engineering College", "SCD Government College", "Christian Medical College", "Bhai Gurdas Group of Institutions"],
        "Amritsar": ["Guru Nanak Dev University", "BBK DAV College for Women", "Khalsa College Amritsar", "DAV College", "Global Institute Amritsar"],
        "Jalandhar": ["Lovely Professional University", "DAV University", "Guru Nanak Dev Engineering College", "Doaba College", "St. Soldier Group of Institutions"],
        "Patiala": ["Thapar Institute of Engineering & Technology", "Punjabi University", "Govt. Mohindra College", "Gian Sagar Medical College", "Multani Mal Modi College"]
    }
};

        const stateSelect = document.getElementById("state");
        const citySelect = document.getElementById("city");
        const collegeSelect = document.getElementById("college");

        Object.keys(statesAndCities).forEach(state => {
            let option = new Option(state, state);
            stateSelect.add(option);
        });

        stateSelect.addEventListener("change", function() {
            citySelect.innerHTML = "<option value=''>Select City</option>";
            collegeSelect.innerHTML = "<option value=''>Select College</option>";
            let cities = statesAndCities[this.value] || {};
            Object.keys(cities).forEach(city => {
                let option = new Option(city, city);
                citySelect.add(option);
            });
        });

        citySelect.addEventListener("change", function() {
            collegeSelect.innerHTML = "<option value=''>Select College</option>";
            let selectedState = stateSelect.value;
            let colleges = statesAndCities[selectedState]?.[this.value] || [];
            colleges.forEach(college => {
                let option = new Option(college, college);
                collegeSelect.add(option);
            });
        });
        </script>        
  </body>

</html>
